/*! IndexedDBShim - v0.1.2 - 2015-04-06 */
"use strict";var idbModules={},cleanInterface=!1;(function(){var e={test:!0};if(Object.defineProperty)try{Object.defineProperty(e,"test",{enumerable:!1}),e.test&&(cleanInterface=!0)}catch(t){}})(),function(e){function t(e,t,n,o){n.target=t,"function"==typeof t[e]&&t[e].apply(t,[n]),"function"==typeof o&&o()}function n(t,n,o){var r;try{r=new DOMException.prototype.constructor(0,n)}catch(i){r=Error(n)}throw r.name=t,r.message=n,e.DEBUG&&(console.log(t,n,o,r),console.trace&&console.trace()),r}var o=function(){this.length=0,this._items=[],cleanInterface&&Object.defineProperty(this,"_items",{enumerable:!1})};if(o.prototype={contains:function(e){return-1!==this._items.indexOf(e)},item:function(e){return this._items[e]},indexOf:function(e){return this._items.indexOf(e)},push:function(e){this._items.push(e),this.length+=1;for(var t=0;this._items.length>t;t++)this[t]=this._items[t]},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var e in this)e===parseInt(e,10)+""&&delete this[e];for(e=0;this._items.length>e;e++)this[e]=this._items[e]}},cleanInterface)for(var r in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(o.prototype,r,{enumerable:!1});e.util={throwDOMException:n,callback:t,quote:function(e){return"'"+e+"'"},StringList:o}}(idbModules),function(idbModules){var Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result,o="blob";updateEncodedBlob(n,t,o)},n.readAsDataURL(e)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(e,t){var n,o,r;if(!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof Blob||e instanceof String)){for(n=0;objects.length>n;n+=1)if(objects[n]===e)return{$ref:paths[n]};if(objects.push(e),paths.push(t),"[object Array]"===Object.prototype.toString.apply(e))for(r=[],n=0;e.length>n;n+=1)r[n]=derez(e[n],t+"["+n+"]");else{r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=derez(e[o],t+"["+JSON.stringify(o)+"]"))}return r}return e instanceof Blob?(queuedObjects.push(t),readBlobAsDataURL(e,t)):e instanceof Boolean?e={$type:"bool",$enc:""+e}:e instanceof Date?e={$type:"date",$enc:e.getTime()}:e instanceof Number?e={$type:"num",$enc:""+e}:e instanceof RegExp&&(e={$type:"regex",$enc:""+e}),e}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(e){var t,n,o,r=";base64,";if(-1===e.indexOf(r))return n=e.split(","),t=n[0].split(":")[1],o=n[1],new Blob([o],{type:t});n=e.split(r),t=n[0].split(":")[1],o=window.atob(n[1]);for(var i=o.length,a=new Uint8Array(i),s=0;i>s;++s)a[s]=o.charCodeAt(s);return new Blob([a.buffer],{type:t})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;value.length>i;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,value[i]="string"==typeof path&&px.test(path)?eval(path):rez(item));else if(void 0!==value.$type)switch(value.$type){case"blob":case"file":value=dataURLToBlob(value.$enc);break;case"bool":value=Boolean("true"===value.$enc);break;case"date":value=new Date(value.$enc);break;case"num":value=Number(value.$enc);break;case"regex":value=eval(value.$enc)}else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,value[name]="string"==typeof path&&px.test(path)?eval(path):rez(item)));return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($),$},encode:function(e,t){function n(e){t(JSON.stringify(e))}this.decycle(e,n)},decode:function(e){return this.retrocycle(JSON.parse(e))}}}();idbModules.Sca=Sca}(idbModules),function(idbModules){function evalComplexKeyPath(keyPath,value){var result,segments=keyPath.split(".");return result=2===segments.length?eval("value['"+segments[0]+"'] && value['"+segments[0]+"']['"+segments[1]+"']"):eval("value['"+segments[0]+"']")}var collations=["","number","string","boolean","object","undefined"],getGenericEncoder=function(){return{encode:function(e){return collations.indexOf(typeof e)+"-"+JSON.stringify(e)},decode:function(e){return e===void 0?void 0:JSON.parse(e.substring(2))}}},types={number:getGenericEncoder("number"),"boolean":getGenericEncoder(),object:getGenericEncoder(),string:{encode:function(e){return collations.indexOf("string")+"-"+e},decode:function(e){return""+e.substring(2)}},undefined:{encode:function(){return collations.indexOf("undefined")+"-undefined"},decode:function(){return void 0}}},Key=function(){return{encode:function(e){return types[typeof e].encode(e)},decode:function(e){return types[collations[e.substring(0,1)]].decode(e)},evalKeyPath:function(e,t){if("[object Array]"===Object.prototype.toString.apply(e)){for(var n=[],o=0;e.length>o;o++)n.push(evalComplexKeyPath(e[o],t));return n}return evalComplexKeyPath(e,t)}}}();idbModules.Key=Key}(idbModules),function(e){var t=function(e,t){return{type:e,debug:t,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};e.Event=t}(idbModules),function(e){var t=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},n=function(){this.onblocked=this.onupgradeneeded=null};n.prototype=t,e.IDBRequest=t,e.IDBOpenRequest=n}(idbModules),function(e,t){var n=function(e,t,n,o){this.lower=e,this.upper=t,this.lowerOpen=n,this.upperOpen=o};n.only=function(e){return new n(e,e,!1,!1)},n.lowerBound=function(e,o){return new n(e,t,o,t)},n.upperBound=function(e,o){return new n(t,e,t,o)},n.bound=function(e,t,o,r){return new n(e,t,o,r)},e.IDBKeyRange=n}(idbModules),function(e,t){function n(n,o,r,i,a,s){!n||n instanceof e.IDBKeyRange||(n=new e.IDBKeyRange(n,n,!1,!1)),this.__range=n,this.source=this.__idbObjectStore=r,this.__req=i,this.key=t,this.direction=o,this.__keyColumnName=a,this.__valueColumnName=s,this.__valueDecoder="value"===s?e.Sca:e.Key,this.source.transaction.__active||e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this.__lastKeyContinued=t,this["continue"]()}n.prototype.__find=function(n,o,r,i,a){a=a||1;var s=this,c=s.source.transaction.db.__storeProperties[s.__idbObjectStore.name],u=c.indexList&&c.indexList[s.__keyColumnName]&&c.indexList[s.__keyColumnName].optionalParams,d=u&&u.multiEntry,l=["SELECT * FROM ",e.util.quote(s.__idbObjectStore.name)],_=[];l.push("WHERE ",s.__keyColumnName," NOT NULL"),!s.__range||s.__range.lower===t&&s.__range.upper===t||(l.push("AND"),d&&s.__range.lower!==t?(l.push(s.__keyColumnName+" like ?"),_.push("%"+s.__range.lower+"%")):(s.__range.lower!==t&&(l.push(s.__keyColumnName+(s.__range.lowerOpen?" >":" >= ")+" ?"),_.push(e.Key.encode(s.__range.lower))),s.__range.lower!==t&&s.__range.upper!==t&&l.push("AND"),s.__range.upper!==t&&(l.push(s.__keyColumnName+(s.__range.upperOpen?" < ":" <= ")+" ?"),_.push(e.Key.encode(s.__range.upper))))),n!==t&&(s.__lastKeyContinued=n,s.__offset=0),s.__lastKeyContinued!==t&&(l.push("AND "+s.__keyColumnName+" >= ?"),_.push(e.Key.encode(s.__lastKeyContinued)));var h="prev"===s.direction||"prevunique"===s.direction?"DESC":"ASC";l.push("ORDER BY ",s.__keyColumnName," "+h),l.push("LIMIT "+a+" OFFSET "+s.__offset),e.DEBUG&&console.log(l.join(" "),_),s.__prefetchedData=null,o.executeSql(l.join(" "),_,function(n,o){o.rows.length>1?(s.__prefetchedData=o.rows,s.__prefetchedIndex=0,e.DEBUG&&console.log("Preloaded "+s.__prefetchedData.length+" records for cursor"),s.__decode(o.rows.item(0),r)):1===o.rows.length?s.__decode(o.rows.item(0),r):(e.DEBUG&&console.log("Reached end of cursors"),r(t,t))},function(t,n){e.DEBUG&&console.log("Could not execute Cursor.continue"),i(n)})},n.prototype.__decode=function(t,n){var o=e.Key.decode(t[this.__keyColumnName]),r=this.__valueDecoder.decode(t[this.__valueColumnName]),i=e.Key.decode(t.key);n(o,r,i)},n.prototype["continue"]=function(n){var o=e.cursorPreloadPackSize||100,r=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,i,a,s){r.__offset++;var c=function(e,n,o){r.key=e,r.value=n,r.primaryKey=o,a(r.key!==t?r:t,r.__req)};return r.__prefetchedData&&(r.__prefetchedIndex++,r.__prefetchedIndex<r.__prefetchedData.length)?(r.__decode(r.__prefetchedData.item(r.__prefetchedIndex),c),t):(r.__find(n,e,c,s,o),t)})},n.prototype.advance=function(n){0>=n&&e.util.throwDOMException("Type Error - Count is invalid - 0 or negative",n);var o=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,r,i,a){o.__offset+=n,o.__find(t,e,function(e,n){o.key=e,o.value=n,i(o.key!==t?o:t,o.__req)},a)})},n.prototype.update=function(n){var o=this,r=this.__idbObjectStore.transaction.__createRequest(function(){});return e.Sca.encode(n,function(i){o.__idbObjectStore.transaction.__pushToQueue(r,function(r,a,s,c){o.__find(t,r,function(t,a,u){var d=o.__idbObjectStore,l=o.__idbObjectStore.transaction.db.__storeProperties,_=[i],h="UPDATE "+e.util.quote(d.name)+" SET value = ?",f=l[d.name]&&l[d.name].indexList;if(f)for(var p in f){var y=f[p];h+=", "+p+" = ?",_.push(e.Key.encode(n[y.keyPath]))}h+=" WHERE key = ?",_.push(e.Key.encode(u)),e.DEBUG&&console.log(h,i,t,u),r.executeSql(h,_,function(e,n){o.__prefetchedData=null,1===n.rowsAffected?s(t):c("No rows with key found"+t)},function(e,t){c(t)})},c)})}),r},n.prototype["delete"]=function(){var n=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(o,r,i,a){n.__find(t,o,function(r,s,c){var u="DELETE FROM  "+e.util.quote(n.__idbObjectStore.name)+" WHERE key = ?";e.DEBUG&&console.log(u,r,c),o.executeSql(u,[e.Key.encode(c)],function(e,o){n.__prefetchedData=null,1===o.rowsAffected?(n.__offset--,i(t)):a("No rows with key found"+r)},function(e,t){a(t)})},a)})},e.IDBCursor=n}(idbModules),function(e,t){function n(e,t){this.indexName=this.name=e,this.__idbObjectStore=this.objectStore=this.source=t;var n=t.transaction.db.__storeProperties[t.name],o=n&&n.indexList;this.keyPath=o&&o[e]&&o[e].keyPath||e,["multiEntry","unique"].forEach(function(t){this[t]=!!(o&&o[e]&&o[e].optionalParams&&o[e].optionalParams[t])},this)}n.prototype.__createIndex=function(n,o,r){var i=this,a=i.__idbObjectStore.transaction;a.__addToTransactionQueue(function(s,c,u){i.__idbObjectStore.__getStoreProps(s,function(){function c(){e.util.throwDOMException(0,"Could not create new index",arguments)}2!==a.mode&&e.util.throwDOMException(0,"Invalid State error, not a version transaction",i.transaction);var d=JSON.parse(i.__idbObjectStore.__storeProps.indexList);d[n]!==t&&e.util.throwDOMException(0,"Index already exists on store",d);var l=n;d[n]={columnName:l,keyPath:o,optionalParams:r},i.__idbObjectStore.__storeProps.indexList=JSON.stringify(d);var _=["ALTER TABLE",e.util.quote(i.__idbObjectStore.name),"ADD",e.util.quote(l),"BLOB"].join(" ");e.DEBUG&&console.log(_),s.executeSql(_,[],function(t){t.executeSql("SELECT * FROM "+e.util.quote(i.__idbObjectStore.name),[],function(t,n){(function r(a){if(n.rows.length>a)try{var s=e.Sca.decode(n.rows.item(a).value),d=e.Key.evalKeyPath(o,s);t.executeSql("UPDATE "+e.util.quote(i.__idbObjectStore.name)+" set "+l+" = ? where key = ?",[e.Key.encode(d),n.rows.item(a).key],function(){r(a+1)},c)}catch(_){r(a+1)}else e.DEBUG&&console.log("Updating the indexes in table",i.__idbObjectStore.__storeProps),t.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[i.__idbObjectStore.__storeProps.indexList,i.__idbObjectStore.name],function(){i.__idbObjectStore.__setReadyState("createIndex",!0),u(i)},c)})(0)},c)},c)},"createObjectStore")})},n.prototype.openCursor=function(t,n){var o=new e.IDBRequest;return new e.IDBCursor(t,n,this.source,o,this.indexName,"value"),o},n.prototype.openKeyCursor=function(t,n){var o=new e.IDBRequest;return new e.IDBCursor(t,n,this.source,o,this.indexName,"key"),o},n.prototype.__fetchIndexData=function(n,o){var r=this;return r.__idbObjectStore.transaction.__addToTransactionQueue(function(i,a,s,c){var u=["SELECT * FROM ",e.util.quote(r.__idbObjectStore.name)," WHERE",r.indexName,"NOT NULL"],d=[];n!==t&&(u.push("AND",r.indexName," = ?"),d.push(e.Key.encode(n))),e.DEBUG&&console.log("Trying to fetch data for Index",u.join(" "),d),i.executeSql(u.join(" "),d,function(n,r){var i;i="count"===o?r.rows.length:0===r.rows.length?t:"key"===o?e.Key.decode(r.rows.item(0).key):e.Sca.decode(r.rows.item(0).value),s(i)},c)})},n.prototype.get=function(e){return this.__fetchIndexData(e,"value")},n.prototype.getKey=function(e){return this.__fetchIndexData(e,"key")},n.prototype.count=function(e){return this.__fetchIndexData(e,"count")},e.IDBIndex=n}(idbModules),function(e){var t=function(t,n,o){this.name=t,this.transaction=n,this.__ready={},this.__setReadyState("createObjectStore",o===void 0?!0:o),this.indexNames=new e.util.StringList;var r=n.db.__storeProperties;if(r[t]&&r[t].indexList){var i=r[t].indexList;for(var a in i)i.hasOwnProperty(a)&&this.indexNames.push(a)}};t.prototype.__setReadyState=function(e,t){this.__ready[e]=t},t.prototype.__waitForReady=function(t,n){var o=!0;if(n!==void 0)o=this.__ready[n]===void 0?!0:this.__ready[n];else for(var r in this.__ready)this.__ready[r]||(o=!1);if(o)t();else{e.DEBUG&&console.log("Waiting for to be ready",n);var i=this;window.setTimeout(function(){i.__waitForReady(t,n)},100)}},t.prototype.__getStoreProps=function(t,n,o){var r=this;this.__waitForReady(function(){r.__storeProps?(e.DEBUG&&console.log("Store properties - cached",r.__storeProps),n(r.__storeProps)):t.executeSql("SELECT * FROM __sys__ where name = ?",[r.name],function(t,o){1!==o.rows.length?n():(r.__storeProps={name:o.rows.item(0).name,indexList:o.rows.item(0).indexList,autoInc:o.rows.item(0).autoInc,keyPath:o.rows.item(0).keyPath&&e.Key.decode(o.rows.item(0).keyPath)||o.rows.item(0).keyPath},e.DEBUG&&console.log("Store properties",r.__storeProps),n(r.__storeProps))},function(){n()})},o)},t.prototype.__deriveKey=function(t,n,o,r){function i(){t.executeSql("SELECT * FROM sqlite_sequence where name like ?",[a.name],function(e,t){1!==t.rows.length?r(0):r(t.rows.item(0).seq)},function(t,n){e.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",n)})}var a=this;a.__getStoreProps(t,function(t){if(t||e.util.throwDOMException(0,"Data Error - Could not locate defination for this table",t),t.keyPath)if(o!==void 0&&e.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",t),n)try{var a=e.Key.evalKeyPath(t.keyPath,n);void 0===a?"true"===t.autoInc?i():e.util.throwDOMException(0,"Data Error - Could not eval key from keyPath"):r(a)}catch(s){e.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",s)}else e.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else o!==void 0?r(o):"false"===t.autoInc?e.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",t):i()})},t.prototype.__insertData=function(t,n,o,r,i,a){var s={};r!==void 0&&(s.key=e.Key.encode(r));var c=JSON.parse(this.__storeProps.indexList);for(var u in c)try{var d=e.Key.evalKeyPath(c[u].keyPath,o);s[c[u].columnName]=e.Key.encode(d)}catch(l){a(l)}var _=["INSERT INTO ",e.util.quote(this.name),"("],h=[" VALUES ("],f=[];for(u in s)_.push(u+","),h.push("?,"),f.push(s[u]);_.push("value )"),h.push("?)"),f.push(n);var p=_.join(" ")+h.join(" ");e.DEBUG&&console.log("SQL for adding",p,f),t.executeSql(p,f,function(){i(r)},function(e,t){a(t)})},t.prototype.add=function(t,n){var o=this,r=o.transaction.__createRequest(function(){});return e.Sca.encode(t,function(e){o.transaction.__pushToQueue(r,function(r,i,a,s){o.__deriveKey(r,t,n,function(n){o.__insertData(r,e,t,n,a,s)})})}),r},t.prototype.put=function(t,n){var o=this,r=o.transaction.__createRequest(function(){});return e.Sca.encode(t,function(i){o.transaction.__pushToQueue(r,function(r,a,s,c){o.__deriveKey(r,t,n,function(n){var a="DELETE FROM "+e.util.quote(o.name)+" where key = ?";r.executeSql(a,[e.Key.encode(n)],function(r,a){e.DEBUG&&console.log("Did the row with the",n,"exist? ",a.rowsAffected),o.__insertData(r,i,t,n,s,c)},function(e,t){c(t)})})})}),r},t.prototype.get=function(t){var n=this;return n.transaction.__addToTransactionQueue(function(o,r,i,a){n.__waitForReady(function(){var r=e.Key.encode(t);e.DEBUG&&console.log("Fetching",n.name,r),o.executeSql("SELECT * FROM "+e.util.quote(n.name)+" where key = ?",[r],function(t,n){e.DEBUG&&console.log("Fetched data",n);try{if(0===n.rows.length)return i();i(e.Sca.decode(n.rows.item(0).value))}catch(o){e.DEBUG&&console.log(o),i(void 0)}},function(e,t){a(t)})})})},t.prototype["delete"]=function(t){var n=this;return n.transaction.__addToTransactionQueue(function(o,r,i,a){n.__waitForReady(function(){var r=e.Key.encode(t);e.DEBUG&&console.log("Fetching",n.name,r),o.executeSql("DELETE FROM "+e.util.quote(n.name)+" where key = ?",[r],function(t,n){e.DEBUG&&console.log("Deleted from database",n.rowsAffected),i()},function(e,t){a(t)})})})},t.prototype.clear=function(){var t=this;return t.transaction.__addToTransactionQueue(function(n,o,r,i){t.__waitForReady(function(){n.executeSql("DELETE FROM "+e.util.quote(t.name),[],function(t,n){e.DEBUG&&console.log("Cleared all records from database",n.rowsAffected),r()},function(e,t){i(t)})})})},t.prototype.count=function(t){var n=this;return n.transaction.__addToTransactionQueue(function(o,r,i,a){n.__waitForReady(function(){var r="SELECT * FROM "+e.util.quote(n.name)+(t!==void 0?" WHERE key = ?":""),s=[];t!==void 0&&s.push(e.Key.encode(t)),o.executeSql(r,s,function(e,t){i(t.rows.length)},function(e,t){a(t)})})})},t.prototype.openCursor=function(t,n){var o=new e.IDBRequest;return new e.IDBCursor(t,n,this,o,"key","value"),o},t.prototype.index=function(t){var n=new e.IDBIndex(t,this);return n},t.prototype.createIndex=function(t,n,o){var r=this;o=o||{},r.__setReadyState("createIndex",!1);var i=new e.IDBIndex(t,r);r.__waitForReady(function(){i.__createIndex(t,n,o)},"createObjectStore"),r.indexNames.push(t);var a=r.transaction.db.__storeProperties[r.name];return a.indexList[t]={keyPath:n,optionalParams:o},i},t.prototype.deleteIndex=function(t){var n=new e.IDBIndex(t,this,!1);return n.__deleteIndex(t),n},e.IDBObjectStore=t}(idbModules),function(e){var t=0,n=1,o=2,r=function(o,r,i){if("number"==typeof r)this.mode=r,2!==r&&e.DEBUG&&console.log("Mode should be a string, but was specified as ",r);else if("string"==typeof r)switch(r){case"readwrite":this.mode=n;break;case"readonly":this.mode=t;break;default:this.mode=t}this.storeNames="string"==typeof o?[o]:o;for(var a=0;this.storeNames.length>a;a++)i.objectStoreNames.contains(this.storeNames[a])||e.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[a]);this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=i,this.error=null,this.onabort=this.onerror=this.oncomplete=null};r.prototype.__executeRequests=function(){if(this.__running&&this.mode!==o)return e.DEBUG&&console.log("Looks like the request set is already running",this.mode),void 0;this.__running=!0;var t=this;window.setTimeout(function(){2===t.mode||t.__active||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",t.__active),t.db.__db.transaction(function(n){function o(t,n){n&&(a.req=n),a.req.readyState="done",a.req.result=t,delete a.req.error;var o=e.Event("success");e.util.callback("onsuccess",a.req,o),s++,i()}function r(){a.req.readyState="done",a.req.error="DOMError";var t=e.Event("error",arguments);e.util.callback("onerror",a.req,t),s++,i()}function i(){return s>=t.__requests.length?(t.__active=!1,t.__requests=[],void 0):(a=t.__requests[s],a.op(n,a.args,o,r),void 0)}t.__tx=n;var a=null,s=0;try{i()}catch(c){e.DEBUG&&console.log("An exception occured in transaction",arguments),"function"==typeof t.onerror&&t.onerror()}},function(){e.DEBUG&&console.log("An error in transaction",arguments),"function"==typeof t.onerror&&t.onerror()},function(){e.DEBUG&&console.log("Transaction completed",arguments),"function"==typeof t.oncomplete&&t.oncomplete()})},1)},r.prototype.__addToTransactionQueue=function(t,n){this.__active||this.mode===o||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var r=this.__createRequest();return this.__pushToQueue(r,t,n),r},r.prototype.__createRequest=function(){var t=new e.IDBRequest;return t.source=this.db,t.transaction=this,t},r.prototype.__pushToQueue=function(e,t,n){this.__requests.push({op:t,args:n,req:e}),this.__executeRequests()},r.prototype.objectStore=function(t){return new e.IDBObjectStore(t,this)},r.prototype.abort=function(){!this.__active&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},r.prototype.READ_ONLY=0,r.prototype.READ_WRITE=1,r.prototype.VERSION_CHANGE=2,e.IDBTransaction=r}(idbModules),function(e){var t=function(t,n,o,r){this.__db=t,this.version=o,this.objectStoreNames=new e.util.StringList;for(var i=0;r.rows.length>i;i++)this.objectStoreNames.push(r.rows.item(i).name);for(this.__storeProperties={},i=0;r.rows.length>i;i++){var a=r.rows.item(i),s=this.__storeProperties[a.name]={};s.keyPath=a.keypath,s.autoInc="true"===a.autoInc,s.indexList=JSON.parse(a.indexList)}this.name=n,this.onabort=this.onerror=this.onversionchange=null};t.prototype.createObjectStore=function(t,n){var o=this;n=n||{},n.keyPath=n.keyPath||null;var r=new e.IDBObjectStore(t,o.__versionTransaction,!1),i=o.__versionTransaction;i.__addToTransactionQueue(function(i,a,s){function c(){e.util.throwDOMException(0,"Could not create new object store",arguments)}o.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",o.transaction);var u=["CREATE TABLE",e.util.quote(t),"(key BLOB",n.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");e.DEBUG&&console.log(u),i.executeSql(u,[],function(o){o.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[t,n.keyPath&&e.Key.encode(n.keyPath),n.autoIncrement?!0:!1,"{}"],function(){r.__setReadyState("createObjectStore",!0),s(r)},c)},c)}),o.objectStoreNames.push(t);var a=o.__storeProperties[t]={};return a.keyPath=n.keyPath,a.autoInc=!!n.autoIncrement,a.indexList={},r},t.prototype.deleteObjectStore=function(t){var n=function(){e.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},o=this;!o.objectStoreNames.contains(t)&&n("Object Store does not exist"),o.objectStoreNames.splice(o.objectStoreNames.indexOf(t),1);var r=o.__versionTransaction;r.__addToTransactionQueue(function(){o.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",o.transaction),o.__db.transaction(function(o){o.executeSql("SELECT * FROM __sys__ where name = ?",[t],function(o,r){r.rows.length>0&&o.executeSql("DROP TABLE "+e.util.quote(t),[],function(){o.executeSql("DELETE FROM __sys__ WHERE name = ?",[t],function(){},n)},n)})})})},t.prototype.close=function(){},t.prototype.transaction=function(t,n){var o=new e.IDBTransaction(t,n||1,this);return o},e.IDBDatabase=t}(idbModules),function(e){var t=4194304;if(window.openDatabase){var n=window.openDatabase("__sysdb__",1,"System Database",t);n.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[])},function(){e.DEBUG&&console.log("Error in sysdb transaction - when creating dbVersions",arguments)});var o={open:function(o,r){function i(){if(!c){var t=e.Event("error",arguments);s.readyState="done",s.error="DOMError",e.util.callback("onerror",s,t),c=!0}}function a(a){var c=window.openDatabase(o,1,o,t);s.readyState="done",r===void 0&&(r=a||1),(0>=r||a>r)&&e.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",r),c.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){t.executeSql("SELECT * FROM __sys__",[],function(t,u){var d=e.Event("success");s.source=s.result=new e.IDBDatabase(c,o,r,u),r>a?n.transaction(function(t){t.executeSql("UPDATE dbVersions set version = ? where name = ?",[r,o],function(){var t=e.Event("upgradeneeded");t.oldVersion=a,t.newVersion=r,s.transaction=s.result.__versionTransaction=new e.IDBTransaction([],2,s.source),e.util.callback("onupgradeneeded",s,t,function(){var t=e.Event("success");e.util.callback("onsuccess",s,t)})},i)},i):e.util.callback("onsuccess",s,d)},i)},i)},i)}var s=new e.IDBOpenRequest,c=!1;return n.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[o],function(e,t){0===t.rows.length?e.executeSql("INSERT INTO dbVersions VALUES (?,?)",[o,r||1],function(){a(0)},i):a(t.rows.item(0).version)},i)},i),s},deleteDatabase:function(o){function r(t){if(!s){a.readyState="done",a.error="DOMError";var n=e.Event("error");n.message=t,n.debug=arguments,e.util.callback("onerror",a,n),s=!0}}function i(){n.transaction(function(t){t.executeSql("DELETE FROM dbVersions where name = ? ",[o],function(){a.result=void 0;var t=e.Event("success");t.newVersion=null,t.oldVersion=c,e.util.callback("onsuccess",a,t)},r)},r)}var a=new e.IDBOpenRequest,s=!1,c=null;return n.transaction(function(n){n.executeSql("SELECT * FROM dbVersions where name = ?",[o],function(n,s){if(0===s.rows.length){a.result=void 0;var u=e.Event("success");return u.newVersion=null,u.oldVersion=c,e.util.callback("onsuccess",a,u),void 0}c=s.rows.item(0).version;var d=window.openDatabase(o,1,o,t);d.transaction(function(t){t.executeSql("SELECT * FROM __sys__",[],function(t,n){var o=n.rows;(function a(n){n>=o.length?t.executeSql("DROP TABLE __sys__",[],function(){i()},r):t.executeSql("DROP TABLE "+e.util.quote(o.item(n).name),[],function(){a(n+1)},function(){a(n+1)})})(0)},function(){i()})},r)})},r),a},cmp:function(t,n){return e.Key.encode(t)>e.Key.encode(n)?1:t===n?0:-1}};e.shimIndexedDB=o}}(idbModules),function(e,t){e.openDatabase!==void 0&&(e.shimIndexedDB=t.shimIndexedDB,e.shimIndexedDB&&(e.shimIndexedDB.__useShim=function(){e.indexedDB=t.shimIndexedDB,e.IDBDatabase=t.IDBDatabase,e.IDBTransaction=t.IDBTransaction,e.IDBCursor=t.IDBCursor,e.IDBKeyRange=t.IDBKeyRange,e.indexedDB!==t.shimIndexedDB&&Object.defineProperty&&Object.defineProperty(e,"indexedDB",{value:t.shimIndexedDB})},e.shimIndexedDB.__debug=function(e){t.DEBUG=e})),"indexedDB"in e||(e.indexedDB=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB);var n=!1;if((navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))&&(navigator.userAgent.match(/Chrome/)||(n=!0)),void 0!==e.indexedDB&&!n||void 0===e.openDatabase){e.IDBDatabase=e.IDBDatabase||e.webkitIDBDatabase,e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction,e.IDBCursor=e.IDBCursor||e.webkitIDBCursor,e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange,e.IDBTransaction||(e.IDBTransaction={});try{e.IDBTransaction.READ_ONLY=e.IDBTransaction.READ_ONLY||"readonly",e.IDBTransaction.READ_WRITE=e.IDBTransaction.READ_WRITE||"readwrite"}catch(o){}}else e.shimIndexedDB.__useShim()}(window,idbModules);
//@ sourceMappingURL=http://nparashuram.com/IndexedDBShim/dist/IndexedDBShim.min.map